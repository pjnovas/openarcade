import './style.scss';
import React, {div} from 'react';
import PropTypes from 'prop-types';
import {connect} from 'react-redux';
import * as locales from '/locales';
import { push } from 'redux-little-router';

import last from 'lodash/last';
import omit from 'lodash/omit';
import get from 'lodash/get';

import ExplodedImage from './ExplodedImage';
import {SET_EXPLORER_BAR, CLEAR_EXPLORER_BAR} from '/components/ExplorerBar';

const enhanceProps = props => omit({
  ...props,
  className: `hover-group ${props.selected === props.id ? 'selected' : ''}`,
  onMouseEnter: props.onEnter(props.id),
  onMouseLeave: props.onLeave(props.id),
  onClick: props.onClick(props.id)
}, ['onLeave', 'onEnter']);

const Path = props => React.createElement('path', enhanceProps(props));
const Group = props => React.createElement('g', enhanceProps(props));

const ExplodedMap = props =>
  <div className="ExplodedMap">
    <svg version="1.1" viewBox="0 0 385.94 289.63">
      <g transform="translate(43.291 23.574)">
        <ExplodedImage/>
      </g>
      <g>
        <Path id="side_left" {...props} transform="translate(43.291 23.574)" d="m65.85 115.11 2.4127 27.358 2.0996 0.90103 58.326-32.096-2.1167-24.077-3.0427-1.4552z" />
        <Path id="side_front" {...props} transform="translate(43.291 23.574)" d="m64.262 133.37-2.7781 1.0583 2.249 28.046 67.601 46.699 2.6458-1.8521-0.52917-28.443z" />
        <Path id="side_right" {...props} d="m213 203.94 60.149-40.131 2.5257 1.3096-2.3386 28.25-58.559 40.505-2.7128-1.5902z" />
        <Path id="side_back" {...props} d="m198.83 106.94-0.13229 27.649 67.601 37.439 1.9844-1.3229 1.9844-27.12-68.792-37.306z" />
        <Path id="side_base" {...props} d="m182.41 140.33 67.802 39.309v2.8384l-54.518 36.242-67.165-43.779-0.18709-3.5547z" />
        <Group id="els" {...props}>
          <path d="m135.93 119.97-5.7547 3.3073-0.52917 9.525 4.8286 3.0427 1.8521-0.66145 0.99219-14.221z" />
          <path d="m186.15 160.96-1.637 1.1693 0.0935 4.0224 5.9868 3.6482 10.29 0.0936 6.3142-3.9289-0.18709-4.1627-1.4967-0.79512z" />
          <path d="m242.23 127.97-1.7198 1.4552 0.66146 13.692 2.4474 1.1906 4.6964-3.5057-0.26459-9.4588z" />
        </Group>
        <Path id="panel" {...props} d="m123.36 101.59 58.634-29.482 72.683 37.587-0.0172 2.7623-58.681 34.112-72.571-42.239z" />
        <Path id="acrylic" {...props} transform="translate(43.291 23.574)" d="m78.584 58.922 61.413-26.727 72.723 34.494 0.0334 1.9878-59.735 33.008-74.435-40.892z" />
        <Path id="ventilation" {...props} d="m91.943 117.27s-4.2995 4.8664-4.2995 7.0398 1.1339 5.7641 5.2917 6.2366c0.94494 0.0945 1.6064-0.47247 1.6064-0.47247l1.7481-0.8977s0.62366 0.33546 0.8599 0.24096c0.23624-0.0945 1.6914-0.80792 1.6914-0.80792l0.33073-0.0472c0.79848 0.2386 1.9712 0.71931 2.4876 0.23387 0.56379-0.53003 0.88134-1.4765 0.88116-1.9513 0.73232-0.38978 3.1514-1.4954 3.1514-1.4954s0.61421 0.61422 1.0867 0.51972 1.3229-0.56696 1.5119-1.2757c0.18899-0.7087 0.0945-1.2284 0.18899-1.4174 1.1812-0.61421 15.922-7.9375 15.922-7.9375s0.61421-0.66146 0.75596-1.1339c0.14174-0.47247 3.0238-4.9137 3.071-5.7641 0.0472-0.85045 0.66146-5.8114-4.8664-6.7563-1.7954 1.0394-31.419 15.686-31.419 15.686z" />
        <Group id="legs" {...props}>
          <path d="m62.574 158.73s-8.0698 3.8365-8.5328 4.6302-0.46302 12.568 0 13.163 8.4005 6.5484 9.2604 6.6807c0.8599 0.1323 12.766-6.2177 12.965-6.6807 0.19844-0.46302 0.29766-2.8443-0.03307-3.3734-0.33073-0.52916-7.7721-5.0932-7.9706-5.6885-0.19844-0.59531-2.5797-7.9375-3.0427-8.2021-0.46302-0.26459-1.6536-1.0583-2.6458-0.52917z" />
          <path transform="translate(43.291 23.574)" d="m147.74 236.89-4.3656-3.1088s-0.99219-0.33073-1.3229 0.46302-3.2412 11.112-3.2412 11.112-0.0661 0.66146 0.26459 0.99219c0.33073 0.33072 11.642 8.3344 11.642 8.3344s1.0583 0.85989 1.9844 0.79375c1.017 0.0411 2.034-0.57878 2.034-0.57878l11.526-8.6155s0.33072-0.59531 0.13229-1.2568c-0.19844-0.66146-3.175-11.245-3.175-11.245s-0.33073-0.26458-1.2568 0.33073c-0.92605 0.59531-4.2995 3.175-4.2995 3.175l-3.3734-2.6458s-0.66146-0.46302-1.4552-0.46302-1.7198 0.52916-1.7198 0.52916z" />
          <path d="m316.45 166.61s-1.7189-0.12862-2.3737 1.0407c-0.65482 1.1693-2.9934 8.1851-2.9934 8.1851l-7.9513 5.4256s-0.5145 1.029-0.46773 2.5257c0.23387 0.88867 0.42096 1.1693 0.79514 1.4499 0.37417 0.28063 11.646 6.3142 11.646 6.3142s0.74835 0.42095 1.3564 0c0.60804-0.42095 8.9802-6.5013 8.9802-6.5013s0.32743-0.42095 0.32743-1.1225 0.0105-11.329-1e-5 -11.81c-0.0117-0.53788-0.89745-1.0459-1.6721-1.5084z" />
        </Group>
        <Group id="controls" {...props}>
          <path transform="translate(43.291 23.574)" d="m95.823 31.26 26.627-11.96v-1.9711c-8.4858-2.7395-7.1655-15.579 1.6704-15.936s12.065 11.838 3.3743 15.836c2.9189-1.2067 5.0781-2.2718 5.0781-2.2718l21.281 10.223-0.43431 1.4366s7.2497-0.60136 7.7174 4.577c0.24012 0 1.0399 1.1146 0.63395 1.8217-0.26509 0.46175-1.6026 2.7279-0.94715 2.6551 1.1866-0.13184 3.0193 0.93544 3.0193 0.93544s-0.26616-2.4933 0.60136-3.0736c-0.56438-3.2004 5.2994-4.2605 8.4524-3.8754 4.3765 0.53454 6.1138 5.2452 5.5792 7.1495 2.1716-1.8709 11.384-1.5407 12.361 1.6704 0.93463 3.0725 1.2027 4.009 0 5.6127-0.13363 2.1382-0.4009 9.7553-0.4009 9.7553s-1.0023 2.205-4.7106 2.4722c-2.2698 0.16359-5.9467-0.30068-6.4813-0.83522l-1.1025-0.50113v5.5458s-3.0736 2.9066-6.2808 2.6727c-3.6207-0.26401-6.8488-2.0713-6.8488-3.0068 0-0.93544-0.0334-5.8465-0.0334-5.8465s-2.4049 2.6635-6.214 2.4388c-2.778-0.16384-4.63-0.33919-6.2474-2.5057-0.40091-1.7373-0.30069-7.1495-0.30069-7.1495s-2.7729-0.66817-3.7084-1.6036l-0.16704 5.5124s-3.4411 2.8397-6.3476 2.6059c-3.354-0.26986-5.9468-1.9377-6.4813-2.3386-1.0023 0.60136-10.29 5.3454-10.29 5.3454l-22.985-11.626-0.40091-10.156z"/>
          <path d="m106.63 221.37-8.0698 4.8948s-1.4552-0.79375-2.1828-0.52917c-0.7276 0.26458-3.2411 3.2412-3.2411 3.2412l0.06615 0.39687-0.99219 0.7276s-0.46302 2.5136 0.8599 3.8365c1.3229 1.3229 2.4474 1.9844 2.9104 1.7859s1.0087-0.76068 1.0087-0.76068 1.0876 0.13614 1.3395-0.11571c0.38034-0.38034 2.712-0.29766 2.9766-0.76068 0.34726-0.3638 0.4134-1.1079 0.21496-2.0671l8.3509-5.0932s1.0583-3.3734-3.2412-5.5562z" />
          <path d="m115.11 227.98-7.811 5.0514s-2.0774-1.1471-2.4983-0.77291-2.7402 3.0648-2.7402 3.0648c-0.0992 0.13229 0.14031 0.46772 0.14031 0.46772s-1.029 0.88867-1.2161 1.2628c-0.23934 1.7264 1.3495 5.1434 3.1833 5.0594 0.70159-0.0935 1.6399-0.50882 1.6399-0.50882s0.30284 0.23905 0.48993 0.19228c0.18708-0.0468 3.8707-0.8556 3.9643-1.2298 0.0935-0.37418 0.25558-1.7084 0.18709-2.058 1.0758-0.8419 8.2154-5.0098 8.2154-5.0098s0.84189-3.9756-3.5547-5.5191z" />
        </Group>
        <Path id="usb" {...props} d="m267.82 222.82-2.9766 2.1828s-0.52916 2.249-0.26458 2.5797 4.0349 2.5797 4.0349 2.5797l-1.3891 3.0427s-0.59531-0.59531-0.99218-0.52917c-0.39688 0.0661-1.9182 0.8599-2.0505 1.5214-0.1323 0.66145-0.19844 2.712-0.19844 2.712l1.5214 1.0583s-0.0661 1.5214 0.13229 2.1828c0.19844 0.66146 2.5524 2.8443 3.3734 2.8443 0.98788 0 32.544-24.143 32.544-24.143s4.6302-7.0776 4.6302-9.5912-0.99218-4.101-2.712-4.6302c-1.1245-0.39687-2.1828 0.79375-2.1828 0.79375l-5.4901-2.9104s-2.9766 1.7859-2.9766 2.1828c0 0.39687-0.33072 3.3073-0.0661 3.5719 0.26458 0.26459 2.3812 1.5214 2.3812 1.5214l-14.751 10.848s-0.52917-0.33073-0.79375-0.26458c-0.26459 0.0661-5.3578 3.9688-5.3578 3.9688s-1.4552 0.92604-2.9766 0.0661c-1.5214-0.8599-2.5135-1.7198-3.4396-1.5875z" />
        <Path id="power_button" {...props} d="m83.301 202.55-10.664 6.3026s-0.90569-0.26361-1.467 0.25086c-0.56127 0.51449-0.91842 1.2458-0.68456 2.649 0.09452 0.56711 0.51235 1.7124 1.0881 2.5878 0.8488 1.2905 1.9585 2.2964 2.2093 2.4636 0.52932 0.35289 1.7306 0.74835 2.2918 0.37418 0.56127-0.37418 0.58465-1.1225 0.58465-1.1225l10.617-6.1739s0.86768-1.3506-0.17574-3.4498c-0.95717-1.9257-1.6943-3.3377-3.3029-3.8408 0 0-0.26894-0.0994-0.49695-0.0409z" />
        <Path id="rpi" {...props} transform="translate(43.291 23.574)" d="m208.86 78.533s-4.1672 1.7198-4.2995 3.7703 0.61068 5.6959 1.8521 6.4823c-1.5875 1.1004-6.1435 3.501-6.0854 4.2714 0.0616 0.81586 1.9182 2.9385 2.249 3.0046 0.33073 0.06615 1.6536 0.66146 1.6536 0.66146s-0.99218 2.712-0.92604 3.7042c0.0661 0.99219 0.66146 1.9182 0.66146 2.3812s-0.19844 1.2568-0.19844 1.2568l6.1516 3.3073s-0.24486 1.1906-0.24486 1.5875c0 0.39688-0.13229 1.9844 0.52917 2.3151 0.66145 0.33073 1.0386 0.52917 1.7662 0.52917 0.7276 0 1.8674-0.40889 2.132-0.47506 0.21782-0.12457 0.51381-1.5755 0.51381-1.5755l15.412 8.0698-0.39688 0.7276 0.0551 2.7474s1.4001 1.0891 1.9292 1.1552c0.52916 0.0662 2.4474 0.1323 2.7781-0.33072 0.33073-0.46303 0.54785-2.7884 0.54086-3.1506-0.0187-0.38552-0.47471-1.0166-0.47471-1.0166l10.186-6.4162 1.9182 1.1245 1.4552-0.85989s0.79375 0.7276 1.1906 0.52916c0.39687-0.19844 4.3656-0.85989 5.0271-3.3734s-1.5214-7.6729-3.638-9.4589c-2.9104-1.8521-41.738-20.968-41.738-20.968z" />
      </g>
    </svg>
  </div>


ExplodedMap.propTypes = {
  selected: PropTypes.string,
  onEnter: PropTypes.func,
  onLeave: PropTypes.func,
  onClick: PropTypes.func
};

export const mapStateToProps = state => ({
  selected: last(get(state, 'explorerBar.id', '').split('.'))
});

const resolveLink = id => (dispatch, getState) => {
  let lang = getState().intl.current;
  let url = get(locales, `${lang}.assembly.links.${id}`);
  dispatch(push(`guide/${url}`));
  window.scroll({top: 0});
};

export const mapDispatchToProps = dispatch => ({
  onEnter: id => () => dispatch({ type: SET_EXPLORER_BAR, payload: `assembly.titles.${id}` }),
  onLeave: id => () => dispatch({ type: CLEAR_EXPLORER_BAR, payload: `assembly.titles.${id}` }),
  onClick: id => () => dispatch(resolveLink(id))
});

export default connect(mapStateToProps, mapDispatchToProps)(ExplodedMap);
